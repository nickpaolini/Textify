#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# Validate commit message format
# Allows: feat: message, fix: message, docs: message, etc.
# Also allows: Merge branch, Revert, etc.

commit_msg=$(cat "$1")

# Conventional Commits pattern
conventional_pattern="^(feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert)(\(.+\))?: .+"

# Allow merge commits and reverts
merge_pattern="^Merge (branch|pull request|remote-tracking branch)"
revert_pattern="^Revert "
initial_pattern="^(Initial commit|Initialize)"

if echo "$commit_msg" | grep -qE "$conventional_pattern"; then
  exit 0
elif echo "$commit_msg" | grep -qE "$merge_pattern"; then
  exit 0
elif echo "$commit_msg" | grep -qE "$revert_pattern"; then
  exit 0
elif echo "$commit_msg" | grep -qE "$initial_pattern"; then
  exit 0
else
  echo "‚ùå Invalid commit message format!"
  echo ""
  echo "Commit message must follow Conventional Commits:"
  echo "  <type>(<scope>): <subject>"
  echo ""
  echo "Types: feat, fix, docs, style, refactor, perf, test, build, ci, chore, revert"
  echo ""
  echo "Examples:"
  echo "  feat: add user authentication"
  echo "  fix(api): resolve CORS issue"
  echo "  docs: update README with setup instructions"
  echo ""
  echo "Your message: $commit_msg"
  exit 1
fi
